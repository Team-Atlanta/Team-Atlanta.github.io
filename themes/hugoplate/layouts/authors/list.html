{{ define "main" }}

  <section class="section py-16" id="team-page">
    <div class="container max-w-7xl mx-auto px-4">
      {{ $teamOrder := slice "multilang" "c" "java" "patch" "sarif" }}
      {{ $teamNames := dict "multilang" "Atlantis-Multilang" "c" "Atlantis-C" "java" "Atlantis-Java" "patch" "Atlantis-Patch" "sarif" "Atlantis-SARIF" }}
      {{ $teamDescriptions := dict "multilang" "Multi-language vulnerability analysis and cross-platform security research" "c" "C/C++ program analysis, memory safety, and low-level security vulnerabilities" "java" "Java bytecode analysis, JVM security, and enterprise application vulnerabilities" "patch" "Automated patch generation and vulnerability remediation systems" "sarif" "SARIF format integration and security tool interoperability" }}
      {{ $teamIcons := dict "multilang" "fa-solid fa-globe" "c" "fa-solid fa-code" "java" "fa-brands fa-java" "patch" "fa-solid fa-wrench" "sarif" "fa-solid fa-file-code" }}
      {{ $teamColors := dict "multilang" "blue" "c" "green" "java" "amber" "patch" "purple" "sarif" "pink" }}
      {{ $leader := slice }}
      {{ $noTeam := slice }}
      {{ $teamMembers := dict }}
      {{ $totalMembers := 0 }}
      {{ $allMembers := slice }}

      <!-- Group authors by team -->
      {{ range .RegularPages }}
        {{ $totalMembers = add $totalMembers 1 }}
        {{ $allMembers = $allMembers | append . }}
        {{ if .Params.team }}
          {{ $currentTeam := .Params.team }}
          {{ if eq $currentTeam "leader" }}
            {{ $leader = $leader | append . }}
          {{ else }}
            {{ $existing := index $teamMembers $currentTeam }}
            {{ if $existing }}
              {{ $teamMembers = merge $teamMembers (dict $currentTeam ($existing | append .)) }}
            {{ else }}
              {{ $teamMembers = merge $teamMembers (dict $currentTeam (slice .)) }}
            {{ end }}
          {{ end }}
        {{ else }}
          {{ $noTeam = $noTeam | append . }}
        {{ end }}
      {{ end }}

      <!-- Modern Header Section -->
      <div class="text-center mb-20">
        <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 dark:from-white dark:via-gray-100 dark:to-white bg-clip-text text-transparent mb-8">
          Our Team
        </h1>
        <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 max-w-4xl mx-auto mb-12 leading-relaxed">
          Meet the brilliant minds revolutionizing cybersecurity with cutting-edge AI research
        </p>
        <div class="inline-flex items-center bg-white dark:bg-gray-800 rounded-full px-8 py-4 shadow-lg border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-green-500 rounded-full mr-3 animate-pulse"></div>
            <i class="fa-solid fa-users text-primary mr-3 text-lg"></i>
            <span class="text-xl font-semibold text-gray-700 dark:text-gray-300">{{ $totalMembers }} Active Members</span>
          </div>
        </div>
      </div>


      <!-- Team Leader -->
      {{ if $leader }}
        {{ range $leader }}
          <div class="mb-16">
            <div class="flex justify-center">
              <div class="member-card leader-card bg-white dark:bg-gray-800 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 p-8 text-center border border-amber-100 dark:border-amber-800 relative overflow-hidden group transform hover:scale-105 max-w-sm"
                   data-name="{{ .Title | lower }}"
                   data-description="{{ .Params.description | lower }}"
                   tabindex="0">

                <div class="absolute -top-20 -right-20 w-40 h-40 bg-amber-100/30 dark:bg-amber-800/20 rounded-full group-hover:scale-150 transition-transform duration-700"></div>

                <div class="absolute top-6 right-6 z-10">
                  <div class="bg-amber-100 dark:bg-amber-800/50 text-amber-700 dark:text-amber-300 px-3 py-1 rounded-full text-xs font-bold shadow-lg">
                    <i class="fa-solid fa-crown mr-1"></i>LEADER
                  </div>
                </div>

                {{ $image := .Params.image }}
                {{ if $image }}
                  <div class="relative mb-6 z-10">
                    <div class="w-32 h-32 mx-auto rounded-full overflow-hidden ring-4 ring-amber-100 dark:ring-amber-800/50 shadow-2xl group-hover:ring-amber-200 dark:group-hover:ring-amber-700 transition-all duration-300">
                      <img src="{{ $image }}" alt="{{ .Title }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy">
                    </div>
                  </div>
                {{ end }}

                <div class="relative z-10">
                  <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">
                    <a href="{{ .RelPermalink }}" class="hover:text-amber-600 transition-colors duration-200 focus:outline-none focus:text-amber-600">{{ .Title }}</a>
                  </h3>
                  <p class="text-amber-600 dark:text-amber-400 text-base font-semibold mb-3">{{ .Params.role | default "Team Leader" }}</p>
                  <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                    {{ .Params.affiliation | default .Params.description }}
                  </p>

                  <div class="flex justify-center space-x-3">
                    {{ range .Params.social }}
                      <a href="{{ .link | safeURL }}"
                         target="_blank"
                         rel="noopener nofollow"
                         class="w-10 h-10 bg-gray-100 dark:bg-gray-700 hover:bg-amber-500 hover:text-white rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2"
                         aria-label="{{ .name }}">
                        <i class="{{ .icon }} text-sm"></i>
                      </a>
                    {{ end }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}

      <!-- Progressive Disclosure Team Sections -->
      {{ range $team := $teamOrder }}
        {{ $members := index $teamMembers $team }}
        {{ if $members }}
          {{ $displayName := index $teamNames $team }}
          {{ $description := index $teamDescriptions $team }}
          {{ $icon := index $teamIcons $team }}
          {{ $color := index $teamColors $team }}

          <div id="team-{{ $team }}" class="team-section mb-12" data-team="{{ $team }}" data-expanded="true">
            <!-- Team Overview Card (Collapsed State) -->
            <div class="team-overview-card bg-white dark:bg-gray-800 rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 dark:border-gray-700 cursor-pointer group"
                 onclick="toggleTeamSection('{{ $team }}')"
                 role="button"
                 tabindex="0"
                 onkeydown="handleKeyPress(event, '{{ $team }}')"
                 aria-expanded="true"
                 aria-controls="team-{{ $team }}-content">

              <div class="p-8">
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-6">
                    <div class="w-16 h-16 bg-{{ $color }}-100 dark:bg-{{ $color }}-900/30 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                      <i class="{{ $icon }} text-3xl text-{{ $color }}-600 dark:text-{{ $color }}-400"></i>
                    </div>
                    <div>
                      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-{{ $color }}-600 transition-colors">
                        {{ $displayName }}
                      </h3>
                      <p class="text-gray-600 dark:text-gray-400">{{ len $members }} team members</p>
                    </div>
                  </div>
                  <div class="flex items-center space-x-4">
                    <div class="bg-{{ $color }}-100 dark:bg-{{ $color }}-900/30 text-{{ $color }}-700 dark:text-{{ $color }}-300 px-4 py-2 rounded-xl font-semibold">
                      {{ len $members }}
                    </div>
                    <i class="fa-solid fa-chevron-down text-gray-400 group-hover:text-{{ $color }}-600 transition-all duration-300 transform group-hover:scale-110 expand-icon" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Team Members Grid (Expanded State) -->
            <div id="team-{{ $team }}-content" class="team-content mt-8" aria-labelledby="team-{{ $team }}" style="opacity: 1; max-height: none; padding-top: 2rem;">
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {{ range $i, $member := $members }}
                  <div class="member-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-500 p-6 text-center border border-gray-100 dark:border-gray-700 group transform hover:-translate-y-2 relative"
                       data-name="{{ $member.Title | lower }}"
                       data-description="{{ $member.Params.description | lower }}"
                       data-institution="{{ $member.Params.description | lower }}"
                       tabindex="0"
                       style="animation-delay: {{ mul $i 100 }}ms;">

                    <div class="absolute top-3 right-3 z-10">
                      <div class="bg-{{ $color }}-100 dark:bg-{{ $color }}-900/30 text-{{ $color }}-600 dark:text-{{ $color }}-400 px-3 py-1 rounded-full text-xs font-bold">
                        {{ upper $team }}
                      </div>
                    </div>

                    {{ $image := $member.Params.image }}
                    {{ if $image }}
                      <div class="relative mb-6">
                        <div class="w-20 h-20 mx-auto rounded-full overflow-hidden ring-3 ring-gray-100 dark:ring-gray-700 group-hover:ring-{{ $color }}-300 dark:group-hover:ring-{{ $color }}-600 transition-all duration-300 shadow-lg">
                          <img src="{{ $image }}" alt="{{ $member.Title }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" loading="lazy">
                        </div>
                      </div>
                    {{ end }}

                    <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-{{ $color }}-600 transition-colors">
                      <a href="{{ $member.RelPermalink }}" class="focus:outline-none focus:text-{{ $color }}-600">{{ $member.Title }}</a>
                    </h4>
                    {{ if $member.Params.role }}
                      <p class="text-{{ $color }}-400 dark:text-{{ $color }}-300 text-sm font-semibold mb-2">{{ $member.Params.role }}</p>
                    {{ end }}
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                      {{ $member.Params.affiliation | default $member.Params.description }}
                    </p>

                    <div class="flex justify-center space-x-3">
                      {{ range $member.Params.social }}
                        <a href="{{ .link | safeURL }}"
                           target="_blank"
                           rel="noopener nofollow"
                           class="w-9 h-9 bg-gray-100 dark:bg-gray-700 hover:bg-{{ $color }}-500 hover:text-white rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-{{ $color }}-500"
                           aria-label="{{ .name }}">
                          <i class="{{ .icon }} text-sm"></i>
                        </a>
                      {{ end }}
                    </div>
                  </div>
                {{ end }}
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}

      <!-- Other Team Members -->
      {{ if $noTeam }}
        <div id="team-members" class="team-section mb-20" data-team="other" data-expanded="true">
          <div class="text-center mb-16">
            <div class="inline-flex items-center bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-3xl px-10 py-6 mb-8">
              <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-6">
                <i class="fa-solid fa-users text-2xl"></i>
              </div>
              <div class="text-left">
                <h2 class="text-4xl font-bold mb-2">Team Members</h2>
                <p class="text-gray-600/80 dark:text-gray-400/80 text-lg">{{ len $noTeam }} additional contributors</p>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {{ range $noTeam }}
              <div class="member-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-500 p-6 text-center border border-gray-100 dark:border-gray-700 group transform hover:-translate-y-2"
                   data-name="{{ .Title | lower }}"
                   data-description="{{ .Params.description | lower }}"
                   tabindex="0">
                {{ $image := .Params.image }}
                {{ if $image }}
                  <div class="relative mb-6">
                    <div class="w-20 h-20 mx-auto rounded-full overflow-hidden ring-3 ring-gray-100 dark:ring-gray-700 group-hover:ring-primary transition-all duration-300">
                      <img src="{{ $image }}" alt="{{ .Title }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    </div>
                  </div>
                {{ end }}
                <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-2">
                  <a href="{{ .RelPermalink }}" class="hover:text-primary transition-colors focus:outline-none focus:text-primary">{{ .Title }}</a>
                </h4>
                {{ if .Params.role }}
                  <p class="text-primary text-sm font-semibold mb-2">{{ .Params.role }}</p>
                {{ end }}
                <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                  {{ .Params.affiliation | default .Params.description }}
                </p>
                <div class="flex justify-center space-x-3">
                  {{ range .Params.social }}
                    <a href="{{ .link | safeURL }}"
                       target="_blank"
                       rel="noopener nofollow"
                       class="w-9 h-9 bg-gray-100 dark:bg-gray-700 hover:bg-primary hover:text-white rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary"
                       aria-label="{{ .name }}">
                      <i class="{{ .icon }} text-sm"></i>
                    </a>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          </div>
        </div>
      {{ end }}


      <!-- Back to Top Button -->
      <div class="fixed bottom-8 right-8 z-50">
        <button id="back-to-top" class="hidden bg-primary text-white w-14 h-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" aria-label="Back to top">
          <i class="fa-solid fa-arrow-up"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- Simplified JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      initializeTeamPage();
    });

    function initializeTeamPage() {
      initializeScrollEffects();
      initializeAnimations();
      initializeAccessibility();
      initializeExpandedSections();
    }
    
    function initializeExpandedSections() {
      // Set initial state for expanded sections
      const expandedSections = document.querySelectorAll('.team-section[data-expanded="true"]');
      expandedSections.forEach(section => {
        const icon = section.querySelector('.expand-icon');
        if (icon) {
          icon.style.transform = 'rotate(180deg)';
        }
      });
    }

    // Team section toggle functionality
    function toggleTeamSection(teamId) {
      const section = document.getElementById(`team-${teamId}`);
      const content = document.getElementById(`team-${teamId}-content`);
      const card = section.querySelector('.team-overview-card');
      const icon = section.querySelector('.expand-icon');

      const isExpanded = section.dataset.expanded === 'true';

      if (isExpanded) {
        // Collapse
        const currentHeight = content.getBoundingClientRect().height;
        content.style.overflow = 'hidden';
        content.style.maxHeight = currentHeight + 'px';
        content.offsetHeight; // Force reflow
        content.style.maxHeight = '0px';
        content.style.opacity = '0';
        content.style.paddingTop = '0px';

        setTimeout(() => {
          content.classList.add('hidden');
        }, 300);

        section.dataset.expanded = 'false';
        card.setAttribute('aria-expanded', 'false');
        icon.style.transform = 'rotate(0deg)';
      } else {
        // Expand
        content.classList.remove('hidden');
        content.style.overflow = 'visible';
        content.style.maxHeight = '0px';
        content.style.opacity = '0';
        content.style.paddingTop = '0px';

        content.offsetHeight; // Force reflow
        
        // Use requestAnimationFrame for proper height calculation
        requestAnimationFrame(() => {
          // Get actual visual height including all borders and margins
          const actualHeight = content.getBoundingClientRect().height;
          const gridHeight = content.querySelector('.grid')?.getBoundingClientRect().height || 0;
          const safeHeight = Math.max(actualHeight, gridHeight) + 30; // 30px safety buffer
          
          content.style.maxHeight = safeHeight + 'px';
          content.style.opacity = '1';
          content.style.paddingTop = '2rem';

          section.dataset.expanded = 'true';
          card.setAttribute('aria-expanded', 'true');
          icon.style.transform = 'rotate(180deg)';

          // Animate member cards
          const memberCards = content.querySelectorAll('.member-card');
          memberCards.forEach((card, index) => {
            setTimeout(() => {
              card.style.animation = `fadeInUp 0.6s ease-out forwards`;
            }, index * 100);
          });
          
          // Final height adjustment after animations
          setTimeout(() => {
            const finalHeight = content.getBoundingClientRect().height + 20;
            content.style.maxHeight = finalHeight + 'px';
          }, 400);
        });
      }
    }

    function handleKeyPress(event, teamId) {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        toggleTeamSection(teamId);
      }
    }

    function initializeScrollEffects() {
      const backToTop = document.getElementById('back-to-top');

      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          backToTop.classList.remove('hidden');
        } else {
          backToTop.classList.add('hidden');
        }
      });

      backToTop.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }

    function initializeAnimations() {
      // Stagger animation for member cards
      const memberCards = document.querySelectorAll('.member-card');
      memberCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 100}ms`;
      });

      // Smooth transitions for content changes
      const teamContents = document.querySelectorAll('.team-content');
      teamContents.forEach(content => {
        content.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
      });
    }

    function initializeAccessibility() {
      // Keyboard navigation for team sections
      const teamCards = document.querySelectorAll('.team-overview-card');
      teamCards.forEach(card => {
        card.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      });

      // Focus management for member cards
      const memberCards = document.querySelectorAll('.member-card');
      memberCards.forEach(card => {
        card.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            const link = this.querySelector('a');
            if (link) link.click();
          }
        });
      });
    }

  </script>

  <!-- Enhanced Styles -->
  <style>

    .team-content {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      /* Ensure proper rendering during animations */
      backface-visibility: hidden;
      transform: translateZ(0);
    }

    .expand-icon {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .member-card {
      animation: fadeInUp 0.6s ease-out forwards;
      animation-fill-mode: both;
      /* Fix border rendering issues */
      border: 1px solid;
      border-color: rgb(243 244 246);
      isolation: isolate;
      will-change: transform;
    }
    
    .dark .member-card {
      border-color: rgb(55 65 81);
    }
    
    /* Ensure proper layout containment */
    .team-content .grid {
      contain: layout;
    }
    
    /* Team color overrides for role text */
    .text-blue-400 { color: #60a5fa !important; }
    .text-green-400 { color: #4ade80 !important; }
    .text-amber-400 { color: #fbbf24 !important; }
    .text-purple-400 { color: #c084fc !important; }
    .text-pink-400 { color: #f472b6 !important; }
    
    .dark .text-blue-300 { color: #93c5fd !important; }
    .dark .text-green-300 { color: #86efac !important; }
    .dark .text-amber-300 { color: #fcd34d !important; }
    .dark .text-purple-300 { color: #d8b4fe !important; }
    .dark .text-pink-300 { color: #f9a8d4 !important; }

    /* Loading skeleton styles */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, transparent 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Focus styles for accessibility */
    .focus-visible {
      @apply outline-none ring-2 ring-primary ring-offset-2;
    }

    /* Smooth color transitions */
    * {
      transition-property: color, background-color, border-color;
      transition-duration: 200ms;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }

  </style>
{{ end }}
