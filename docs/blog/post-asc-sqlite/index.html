<!doctype html><html itemscope lang=en-us itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=theme-name content="hugoplate"><link rel="shortcut icon" href=/images/team-icon_huf9440efed39ba7d24ba35d33aee39304_52547_96x0_resize_lanczos.png type=image/x-icon><link rel=icon href=/images/team-icon_huf9440efed39ba7d24ba35d33aee39304_52547_96x0_resize_lanczos.png type=image/x-icon><link rel=icon type=image/png sizes=48x48 href=/images/team-icon_huf9440efed39ba7d24ba35d33aee39304_52547_48x0_resize_lanczos.png><link rel=icon type=image/png sizes=96x96 href=/images/team-icon_huf9440efed39ba7d24ba35d33aee39304_52547_96x0_resize_lanczos.png><link rel=apple-touch-icon sizes=144x144 href=/images/team-icon_huf9440efed39ba7d24ba35d33aee39304_52547_144x0_resize_lanczos.png><link rel=manifest href=/manifest.webmanifest><meta name=msapplication-TileColor content="#ddd"><meta name=theme-color content="#ffffff"><base href=https://team-atlanta.github.io/blog/post-asc-sqlite/><title>Autonomously Uncovering and Fixing a Hidden Vulnerability in SQLite3 with an LLM-Based System</title>
<meta name=keywords content="DARPA AIxCC,cybersecurity,fuzzing,LLM,AIxCC"><meta name=description content="SQLite3 in ASC"><meta property="og:image" content="https://team-atlanta.github.io/images/blog/asc-sqlite/sqlite-bug-finding.png"><meta name=twitter:image content="https://team-atlanta.github.io/images/blog/asc-sqlite/sqlite-bug-finding.png"><meta name=twitter:card content="summary
            _large_image
          "><meta property="og:image:width" content="1024"><meta property="og:image:height" content="768"><meta property="og:image:type" content="image/
        .png
      "><meta property="og:title" content="Autonomously Uncovering and Fixing a Hidden Vulnerability in SQLite3 with an LLM-Based System"><meta property="og:description" content="SQLite3 in ASC"><meta property="og:type" content="website"><meta property="og:url" content="https://team-atlanta.github.io/blog/post-asc-sqlite/"><meta name=twitter:title content="Autonomously Uncovering and Fixing a Hidden Vulnerability in SQLite3 with an LLM-Based System"><meta name=twitter:description content="SQLite3 in ASC"><script>let indexURL="https://team-atlanta.github.io/searchindex.json",includeSectionsInSearch=["blog"],no_results_for="No results for",empty_search_results_placeholder="Type something to search.."</script><meta http-equiv=x-dns-prefetch-control content="on"><link rel=preconnect href=https://use.fontawesome.com crossorigin><link rel=preconnect href=//cdnjs.cloudflare.com><link rel=preconnect href=//www.googletagmanager.com><link rel=preconnect href=//www.google-analytics.com><link rel=dns-prefetch href=https://use.fontawesome.com><link rel=dns-prefetch href=//ajax.googleapis.com><link rel=dns-prefetch href=//cdnjs.cloudflare.com><link rel=dns-prefetch href=//www.googletagmanager.com><link rel=dns-prefetch href=//www.google-analytics.com><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//connect.facebook.net><link rel=dns-prefetch href=//platform.linkedin.com><link rel=dns-prefetch href=//platform.twitter.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&family=Signika:wght@500;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link href="/css/style.min.0e242a40cb27e6a52141f75708f5bbbe959960e962a16f97f1ef4c31ea370780.css" integrity="sha256-DiQqQMsn5qUhQfdXCPW7vpWZYOlioW+X8e9MMeo3B4A=" rel=stylesheet><link defer async rel=stylesheet href="/css/style-lazy.min.1a9d1009e7f8ece0fee6bf42b15ba299b3f17268c302b871323434f820c6b503.css" integrity="sha256-Gp0QCef47OD+5r9CsVuimbPxcmjDArhxMjQ0+CDGtQM=" media=print onload='this.media="all",this.onload=null'></head><body><header class="header sticky top-0 z-30"><nav class="navbar container"><div class=order-0><a class="navbar-brand block" href=/>Team Atlanta</a></div><input id=nav-toggle type=checkbox class=hidden>
<label for=nav-toggle class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1"><svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg><svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8"><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/authors/>AIxCC Team</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li></ul><div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0"><button aria-label=search class="border-border text-dark hover:text-primary dark:border-darkmode-border mr-5 inline-block border-r pr-5 text-xl dark:text-white dark:hover:text-darkmode-primary" data-target=search-modal>
<i class="fa-solid fa-search"></i></button><div class="theme-switcher mr-5"><input id=theme-switcher data-theme-switcher type=checkbox>
<label for=theme-switcher><span class=sr-only>theme switcher</span>
<span><svg class="absolute left-[4px] top-[4px] z-10 opacity-100 dark:opacity-0" viewBox="0 0 56 56" fill="#fff" height="16" width="16"><path d="M30 4.6c0-1-.9-2-2-2a2 2 0 00-2 2v5c0 1 .9 2 2 2s2-1 2-2zm9.6 9a2 2 0 000 2.8c.8.8 2 .8 2.9.0L46 13a2 2 0 000-2.9 2 2 0 00-3 0zm-26 2.8c.7.8 2 .8 2.8.0.8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9.0-.7.8-.7 2.1.0 3zM28 16A12 12 0 0016 28a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0028 16zm23.3 14c1.1.0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 00-2 2c0 1.1 1 2 2 2zM4.7 26a2 2 0 00-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2zm37.8 13.6a2 2 0 00-3 0 2 2 0 000 2.9l3.6 3.5a2 2 0 002.9.0c.8-.8.8-2.1.0-3zM10 43.1a2 2 0 000 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1.0-2.9s-2-.8-2.9.0zm20 3.4c0-1.1-.9-2-2-2a2 2 0 00-2 2v4.9c0 1 .9 2 2 2s2-1 2-2z"/></svg><svg class="absolute left-[4px] top-[4px] z-10 opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" height="16" width="16"><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4.0 008.7 1.8c1-.3 2 .5 1.5 1.5v.1A10.3 10.3.0 0112.4 22 10.3 10.3.0 013.2 6.7c1-2 2.9-3.5 4.9-4.4z"/></svg></span></label></div><script>var darkMode=!1,themeSwitch;window.matchMedia("(prefers-color-scheme: dark)").matches&&(darkMode=!0),localStorage.getItem("theme")==="dark"?darkMode=!0:localStorage.getItem("theme")==="light"&&(darkMode=!1),darkMode&&document.documentElement.classList.toggle("dark"),themeSwitch=document.querySelectorAll("[data-theme-switcher]"),document.addEventListener("DOMContentLoaded",()=>{[].forEach.call(themeSwitch,function(e){e.checked=!!darkMode,e.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")})})})</script></div></nav></header><div class=search-modal aria-hidden=true style=--color-primary:#121212><div data-target=close-search-modal class=search-modal-overlay></div><div class=search-wrapper data-image=true data-description=true data-tags=true data-categories=true><div class=search-wrapper-header><label for=search-modal-input style=margin-top:-1px><span class=sr-only>search icon</span>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-icon" data-type="search"><path fill="currentcolor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8.0 45.3s-32.8 12.5-45.3.0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9.0 208S93.1.0 208 0 416 93.1 416 208zM208 352a144 144 0 100-288 144 144 0 100 288z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-reset" data-type="reset"><path fill="currentcolor" d="M256 512A256 256 0 10256 0a256 256 0 100 512zM175 175c9.4-9.4 24.6-9.4 33.9.0l47 47 47-47c9.4-9.4 24.6-9.4 33.9.0s9.4 24.6.0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6.0 33.9s-24.6 9.4-33.9.0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9.0s-9.4-24.6.0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6.0-33.9z"/></svg></label><input id=search-modal-input type=text data-search-input autocomplete=off aria-label=Search placeholder="Search Post ..."></div><div class=search-wrapper-body><div class=search-result data-search-result></div><span class=search-result-empty>Type something to search..</span></div><div class=search-wrapper-footer><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" viewBox="0 0 16 16"><path d="M3.204 11h9.592L8 5.519 3.204 11zm-.753-.659 4.796-5.48a1 1 0 011.506.0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 01-.753-1.659z"/></svg></kbd><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" style="margin-top:1px" viewBox="0 0 16 16"><path d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 001.506.0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 00-.753 1.659z"/></svg></kbd>to navigate
</span><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentcolor" style="display:inline-block" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M14.5 1.5a.5.5.0 01.5.5v4.8a2.5 2.5.0 01-2.5 2.5H2.707l3.347 3.346a.5.5.0 01-.708.708l-4.2-4.2a.5.5.0 010-.708l4-4a.5.5.0 11.708.708L2.707 8.3H12.5A1.5 1.5.0 0014 6.8V2a.5.5.0 01.5-.5z"/></svg></kbd>to select
</span><span class=search-result-info></span>
<span data-target=close-search-modal><kbd>ESC</kbd> to close</span></div></div></div><main><section class="section pt-7"><div class=container><div class="row justify-center"><article class=lg:col-10><div class=mb-10><picture><source srcset=/images/blog/asc-sqlite/sqlite-bug-finding_hu74f0b92a25ffe4a281fdd3139be11b7b_1377840_545x0_resize_q90_h2_lanczos_3.webp media="(max-width: 575px)"><source srcset=/images/blog/asc-sqlite/sqlite-bug-finding_hu74f0b92a25ffe4a281fdd3139be11b7b_1377840_600x0_resize_q90_h2_lanczos_3.webp media="(max-width: 767px)"><source srcset=/images/blog/asc-sqlite/sqlite-bug-finding_hu74f0b92a25ffe4a281fdd3139be11b7b_1377840_700x0_resize_q90_h2_lanczos_3.webp media="(max-width: 991px)"><source srcset=/images/blog/asc-sqlite/sqlite-bug-finding_hu74f0b92a25ffe4a281fdd3139be11b7b_1377840_1110x0_resize_q90_h2_lanczos_3.webp><img loading=lazy decoding=async src=/images/blog/asc-sqlite/sqlite-bug-finding_hu74f0b92a25ffe4a281fdd3139be11b7b_1377840_1110x0_resize_lanczos_3.png class="w-full rounded img" alt="Autonomously Uncovering and Fixing a Hidden Vulnerability in SQLite3 with an LLM-Based System" width=1024 height=768></picture></div><h1 class="h2 mb-4">Autonomously Uncovering and Fixing a Hidden Vulnerability in SQLite3 with an LLM-Based System</h1><ul class=mb-4><li class="mr-4 inline-block"><a href=/authors/hanqing-zhao/><i class="fa-regular fa-circle-user mr-2"></i>Hanqing Zhao</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/vulnerability-analysis/ class=ms-1>Vulnerability analysis</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
August 28, 2024</li></ul><div class="content mb-10"><p>Without knowing beforehand that the challenge project involved SQLite3,
our team, <a href=/authors>Team Atlanta</a>
, entered our Cyber Reasoning System (CRS),
named Atlantis,
into the <a href=https://aicyberchallenge.com/ target=_blank>AI Cyber Challenge</a>
organized by ARPA-H, DARPA, and the
<a href=https://www.whitehouse.gov/briefing-room/statements-releases/2023/08/09/biden-harris-administration-launches-artificial-intelligence-cyber-challenge-to-protect-americas-critical-software/ target=_blank>White House</a>
.</p><p>Remarkably,
Atlantis secured six first-bloods and
autonomously identified and patched a real bug in SQLite3<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>,
earning us a $2 million prize and a place in the grand finals of AIxCC.
For more details, check out our <a href=/blog/post-atl>team&rsquo;s announcement blog</a>
.</p><p>In this blog,
we will outline our very high-level approach to using LLMs for bug detection and
vulnerability remediation,
provide an analysis of the fixed SQLite3 vulnerability,
and discuss the challenges of using our LLM agents for such fixes.</p><p>Follow us on Twitter/X (<a href=https://x.com/TeamAtlanta24 target=_blank>@TeamAtlanta24</a>
)
if you&rsquo;re interested in AI or security.</p><h2 id=the-atlantis-cyber-reasoning-system>The Atlantis Cyber Reasoning System</h2><p>Atlantis is a end-to-end,
large language model (LLM)-based bug-finding and
fixing system designed to function entirely without human intervention.
It is capable of handling complex systems like the Linux kernel and
supports a range of modern programming languages, including C/C++, Java, and others.</p><p>Our design philosophy is simple:
to emulate the mindset of experienced security researchers and
hackers through LLM agents,
enhanced with advanced program analysis techniques.</p><p>Atlantis is specifically designed to replicate the behavior of human researchers,
particularly in auditing the Git repositories of open-source software (OSS).
To harness the full potential of LLMs and
address their limitations in tackling complex problems,
we incorporate traditional program analysis techniques
(both dynamic and static) to assist LLMs in decision-making.</p><p>One of the interesting features of Atlantis is
our &ldquo;baby-security-AGI&rdquo; system,
which can emulate the code auditing process based on
the habits of the security experts on our team.
It&rsquo;s not magic; we&rsquo;ve distilled our collective experience and common practices in
manual auditing and reverse engineering into structured prompts,
significantly enhancing the system&rsquo;s capabilities.</p><p>All source code will be open-sourced in accordance with the AIxCC competition rules.</p><h2 id=the-off-by-one-access-in-sqlite3>The Off-by-One Access in SQLite3</h2><p>The hidden vulnerability was discovered in the
<a href=https://www.sqlite.org/fts5.html target=_blank>FTS5 module</a>
of SQLite3
(<a href=https://sqlite.org/forum/forumpost/171bcc2bcd target=_blank>link</a>
).
The bug is located in the trigram tokenizer,
which processes each contiguous sequence of three characters as a token,
enabling FTS5 to support more general substring matching.</p><p>When creating a virtual table,
users can specify options in the <code>trigram</code> field (e.g., <code>case_sensitive 1</code>)
as outlined in the <a href=https://www.sqlite.org/fts5.html target=_blank>documentation</a>
.</p><p>However, if users fail to provide key-value pairs,
SQLite3 does not adequately check for this and assumes that the value is present.
This assumption can lead to an off-by-one access error.
Because SQLite3 allocates a sufficient heap buffer in such cases,
the off-by-one access is confined to the space within an allocated heap chunk.
Additionally, due to SQLite&rsquo;s good coding practices,
it uses <code>MallocZero</code> to ensure no uninitialized variables exist,
which ultimately results in a zero pointer dereference.</p><details><summary>Click me to show the vulnerable code in SQLite3</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>fts5TriCreate</span>(
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>pUnused,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>azArg,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> nArg,
</span></span><span style=display:flex><span>  Fts5Tokenizer <span style=color:#f92672>**</span>ppOut
</span></span><span style=display:flex><span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> SQLITE_OK;
</span></span><span style=display:flex><span>  TrigramTokenizer <span style=color:#f92672>*</span>pNew <span style=color:#f92672>=</span> (TrigramTokenizer<span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_malloc</span>(<span style=color:#66d9ef>sizeof</span>(<span style=color:#f92672>*</span>pNew));
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>UNUSED_PARAM</span>(pUnused);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>( pNew<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span> ){
</span></span><span style=display:flex><span>    rc <span style=color:#f92672>=</span> SQLITE_NOMEM;
</span></span><span style=display:flex><span>  }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> i;
</span></span><span style=display:flex><span>    pNew<span style=color:#f92672>-&gt;</span>bFold <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    pNew<span style=color:#f92672>-&gt;</span>iFoldParam <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; rc<span style=color:#f92672>==</span>SQLITE_OK <span style=color:#f92672>&amp;&amp;</span> i<span style=color:#f92672>&lt;</span>nArg; i<span style=color:#f92672>+=</span><span style=color:#ae81ff>2</span>){
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>zArg <span style=color:#f92672>=</span> azArg[i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]; <span style=color:#f92672>&lt;----</span> off<span style=color:#f92672>-</span>by<span style=color:#f92672>-</span>one
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>( <span style=color:#ae81ff>0</span><span style=color:#f92672>==</span><span style=color:#a6e22e>sqlite3_stricmp</span>(azArg[i], <span style=color:#e6db74>&#34;case_sensitive&#34;</span>) ){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>( (zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;1&#39;</span>) <span style=color:#f92672>||</span> zArg[<span style=color:#ae81ff>1</span>] ){ <span style=color:#f92672>&lt;----</span>null dereference 
</span></span><span style=display:flex><span>          rc <span style=color:#f92672>=</span> SQLITE_ERROR;
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>          pNew<span style=color:#f92672>-&gt;</span>bFold <span style=color:#f92672>=</span> (zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>==</span><span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>( <span style=color:#ae81ff>0</span><span style=color:#f92672>==</span><span style=color:#a6e22e>sqlite3_stricmp</span>(azArg[i], <span style=color:#e6db74>&#34;remove_diacritics&#34;</span>) ){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>( (zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#f92672>&amp;&amp;</span> zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;2&#39;</span>) <span style=color:#f92672>||</span> zArg[<span style=color:#ae81ff>1</span>] ){ <span style=color:#f92672>&lt;--</span>
</span></span><span style=display:flex><span>          rc <span style=color:#f92672>=</span> SQLITE_ERROR;
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>          pNew<span style=color:#f92672>-&gt;</span>iFoldParam <span style=color:#f92672>=</span> (zArg[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;0&#39;</span>) <span style=color:#f92672>?</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        rc <span style=color:#f92672>=</span> SQLITE_ERROR;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>( pNew<span style=color:#f92672>-&gt;</span>iFoldParam<span style=color:#f92672>!=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> pNew<span style=color:#f92672>-&gt;</span>bFold<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span> ){
</span></span><span style=display:flex><span>      rc <span style=color:#f92672>=</span> SQLITE_ERROR;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>( rc<span style=color:#f92672>!=</span>SQLITE_OK ){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fts5TriDelete</span>((Fts5Tokenizer<span style=color:#f92672>*</span>)pNew);
</span></span><span style=display:flex><span>      pNew <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>ppOut <span style=color:#f92672>=</span> (Fts5Tokenizer<span style=color:#f92672>*</span>)pNew;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> rc;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><p>Working proof-of-concepts (PoCs) to trigger the bug are as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>PoC <span style=color:#ae81ff>1</span>: <span style=color:#66d9ef>CREATE</span> VIRTUAL <span style=color:#66d9ef>TABLE</span> t <span style=color:#66d9ef>USING</span> fts5(s, tokenize<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;trigram case_sensitive&#39;</span>);
</span></span><span style=display:flex><span>PoC <span style=color:#ae81ff>2</span>: <span style=color:#66d9ef>CREATE</span> VIRTUAL <span style=color:#66d9ef>TABLE</span> t <span style=color:#66d9ef>USING</span> fts5(s, tokenize<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;trigram remove_diacritics&#39;</span>);
</span></span></code></pre></div><p>While human researchers might consider this bug trivial,
I am still pleased that our system enabled us to be the only team
to discover a real bug—even without knowing that the challenge project was SQLite3.</p><h2 id=auto-generated-patch-vs-human-write-patch>Auto-Generated Patch vs Human-Write Patch</h2><p>Automatically patching the aforementioned bug is challenging
because a perfect patch<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> requires the human or AI patcher to understand that
the arguments are paired and that the null pointer dereference results from
an off-by-one heap access within a glibc-allocated heap chunk.</p><p>In other words, the actual root cause is a semantic inconsistency
concerning the paired arguments.
Therefore, the patcher needs to recognize that
the code must verify if the number of arguments is even.</p><h3 id=generating-patches-using-a-naive-zero-shot-prompt>Generating Patches Using a Naive Zero-Shot Prompt</h3><p>To get a basic sense of how LLMs reason about patch generation,
I asked the models to analyze the root cause and generate a patch for
the given bug using the crash logs, PoCs,
and the code of the <code>fts5TriCreate()</code> function.</p><details><summary>A patch generated by Claude 3.5 sonnet</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>--- a/sqlite3.c
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/sqlite3.c
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -255841,7 +255841,7 @@ static int fts5TriCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span><span style=display:flex><span>       const char *zArg = azArg[i+1]; 
</span></span><span style=display:flex><span>       if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span><span style=display:flex><span><span style=color:#f92672>-        if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39;) || zArg[1] ){ 
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+        if( !zArg || (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39;) || zArg[1] ){ 
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }else{
</span></span><span style=display:flex><span>           pNew-&gt;bFold = (zArg[0]==&#39;0&#39;);
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -255849,7 +255849,7 @@ static int fts5TriCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       }else if( 0==sqlite3_stricmp(azArg[i], &#34;remove_diacritics&#34;) ){
</span></span><span style=display:flex><span><span style=color:#f92672>-        if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39; &amp;&amp; zArg[0]!=&#39;2&#39;) || zArg[1] ){ 
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+        if( !zArg || (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39; &amp;&amp; zArg[0]!=&#39;2&#39;) || zArg[1] ){ 
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }else{
</span></span><span style=display:flex><span>           pNew-&gt;iFoldParam = (zArg[0]!=&#39;0&#39;) ? 2 : 0;
</span></span></code></pre></div></details><details><summary>A patch generated by ChatGPT 4o</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>--- a/sqlite3.c
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/sqlite3.c
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -255835,11 +255835,15 @@
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     pNew-&gt;iFoldParam = 0;
</span></span><span style=display:flex><span>     for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span><span style=display:flex><span>       const char *zArg = azArg[i+1]; 
</span></span><span style=display:flex><span><span style=color:#f92672>-      if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+      if( i+1 &gt;= nArg || azArg[i+1] == NULL ){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+        rc = SQLITE_ERROR;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+      }else if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>         if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39;) || zArg[1] ){ 
</span></span><span style=display:flex><span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }else{
</span></span><span style=display:flex><span>           pNew-&gt;bFold = (zArg[0]==&#39;0&#39;);
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>       }else if( 0==sqlite3_stricmp(azArg[i], &#34;remove_diacritics&#34;) ){
</span></span><span style=display:flex><span>         if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39; &amp;&amp; zArg[0]!=&#39;2&#39;) || zArg[1] ){ 
</span></span><span style=display:flex><span>           rc = SQLITE_ERROR;
</span></span></code></pre></div></details><p>The patches are fairly close to &ldquo;good patches,&rdquo;
and the models almost identify the root causes.
However, due to my simple zero-shot prompt,
there are still a few minor issues.
For example,
the patch generated by Claude effectively mitigates the bug by ensuring that
a null pointer is always handled when the bug is triggered,
but it doesn&rsquo;t fully address the off-by-one root cause.
The patch generated by GPT-4o addresses the bounds check but
only covers the <code>case_sensitive</code> branch, missing the <code>remove_diacritics</code> branch.</p><p>Nonetheless, the results are promising given that a simple prompt was used,
and the LLMs almost arrived at the correct solution.
However, in real-world scenarios,
patch generation can be much more challenging,
as it requires
locating the source code of the vulnerable parts in a large codebase,
dealing with indeterminate results,
handling hallucinations,
and validating correctness, among other issues.</p><h3 id=patch-generated-by-atlantis-crs>Patch Generated by Atlantis CRS</h3><p>Atlantis CRS generates patches by
incrementally applying domain-specific knowledge with multiple LLM agents and
iteratively refining them using a custom validation oracle.
The patch generated by Atlantis is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>diff --git a/ext/fts5/fts5_tokenize.c b/ext/fts5/fts5_tokenize.c
</span></span><span style=display:flex><span>index f12056170..552f14be9 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/ext/fts5/fts5_tokenize.c
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/ext/fts5/fts5_tokenize.c
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -1299,8 +1299,10 @@ static int fts5TriCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     pNew-&gt;bFold = 1;
</span></span><span style=display:flex><span>     pNew-&gt;iFoldParam = 0;
</span></span><span style=display:flex><span>     for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span><span style=display:flex><span><span style=color:#f92672>-      const char *zArg = azArg[i+1];
</span></span></span><span style=display:flex><span><span style=color:#f92672>-      if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+      const char *zArg = (i+1 &lt; nArg) ? azArg[i+1] : NULL;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+      if (zArg == NULL) {
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+        rc = SQLITE_ERROR;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+      } else if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>         if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39;) || zArg[1] ){
</span></span><span style=display:flex><span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }else{
</span></span></code></pre></div><p>The auto-generated patch successfully checks
the bounds and provides additional protection against null pointer dereference.
In this case,
Atlantis spent ~15 minutes for the entire building, patch generation,
iteration, and correctness-validation process,
demonstrating its promising potential for application to real-world software.</p><p>Admittedly,
our patching techniques are still in their prototype stages,
as we require more time to apply and evaluate the many new ideas we have.
However,
the patch above illustrates that
LLM-based automated vulnerability remediation is a very feasible direction.</p><p>Thanks <a href=/authors/seunggi-min/>Seunggi</a>
for collecting the statistics when patching the bug.</p><h3 id=official-sqlite3-patch>Official SQLite3 patch</h3><details><summary>Click me to show SQlite3's official patch</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>commit e9b919d550262076d1b8453c3d6852b88822b922
</span></span><span style=display:flex><span>Author: drh &lt;&gt;
</span></span><span style=display:flex><span>Date:   Tue Aug 6 22:49:01 2024 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Improved robustness of parsing of tokenize= arguments in FTS5.
</span></span><span style=display:flex><span>    [forum:/forumpost/171bcc2bcd|Forum post 171bcc2bcd].
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    FossilOrigin-Name: d9f726ade6b258f8723f90d0b04a4682e885e30939eb29773913e4dfc8e85503
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>diff --git a/ext/fts5/fts5_tokenize.c b/ext/fts5/fts5_tokenize.c
</span></span><span style=display:flex><span>index 3e9fdff3e..08de0d60d 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/ext/fts5/fts5_tokenize.c
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/ext/fts5/fts5_tokenize.c
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -79,7 +79,7 @@ static int fts5AsciiCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       int i;
</span></span><span style=display:flex><span>       memset(p, 0, sizeof(AsciiTokenizer));
</span></span><span style=display:flex><span>       memcpy(p-&gt;aTokenChar, aAsciiTokenChar, sizeof(aAsciiTokenChar));
</span></span><span style=display:flex><span><span style=color:#f92672>-      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg-1; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>         const char *zArg = azArg[i+1];
</span></span><span style=display:flex><span>         if( 0==sqlite3_stricmp(azArg[i], &#34;tokenchars&#34;) ){
</span></span><span style=display:flex><span>           fts5AsciiAddExceptions(p, zArg, 1);
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -90,6 +90,7 @@ static int fts5AsciiCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span><span style=color:#a6e22e>+      if( i&lt;nArg ) rc = SQLITE_ERROR;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>       if( rc!=SQLITE_OK ){
</span></span><span style=display:flex><span>         fts5AsciiDelete((Fts5Tokenizer*)p);
</span></span><span style=display:flex><span>         p = 0;
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -381,17 +382,16 @@ static int fts5UnicodeCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       /* Search for a &#34;categories&#34; argument */
</span></span><span style=display:flex><span><span style=color:#f92672>-      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg-1; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>         if( 0==sqlite3_stricmp(azArg[i], &#34;categories&#34;) ){
</span></span><span style=display:flex><span>           zCat = azArg[i+1];
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span><span style=color:#f92672>-
</span></span></span><span style=display:flex><span><span style=color:#f92672></span>       if( rc==SQLITE_OK ){
</span></span><span style=display:flex><span>         rc = unicodeSetCategories(p, zCat);
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+      for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg-1; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>         const char *zArg = azArg[i+1];
</span></span><span style=display:flex><span>         if( 0==sqlite3_stricmp(azArg[i], &#34;remove_diacritics&#34;) ){
</span></span><span style=display:flex><span>           if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39; &amp;&amp; zArg[0]!=&#39;2&#39;) || zArg[1] ){
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -416,6 +416,7 @@ static int fts5UnicodeCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>           rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span><span style=color:#a6e22e>+      if( i&lt;nArg ) rc = SQLITE_ERROR;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>
</span></span><span style=display:flex><span>     }else{
</span></span><span style=display:flex><span>       rc = SQLITE_NOMEM;
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -1298,7 +1299,7 @@ static int fts5TriCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     int i;
</span></span><span style=display:flex><span>     pNew-&gt;bFold = 1;
</span></span><span style=display:flex><span>     pNew-&gt;iFoldParam = 0;
</span></span><span style=display:flex><span><span style=color:#f92672>-    for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+    for(i=0; rc==SQLITE_OK &amp;&amp; i&lt;nArg-1; i+=2){
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>       const char *zArg = azArg[i+1];
</span></span><span style=display:flex><span>       if( 0==sqlite3_stricmp(azArg[i], &#34;case_sensitive&#34;) ){
</span></span><span style=display:flex><span>         if( (zArg[0]!=&#39;0&#39; &amp;&amp; zArg[0]!=&#39;1&#39;) || zArg[1] ){
</span></span><span style=display:flex><span><span style=color:#75715e>@@ -1316,6 +1317,7 @@ static int fts5TriCreate(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>         rc = SQLITE_ERROR;
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span><span style=color:#a6e22e>+    if( i&lt;nArg ) rc = SQLITE_ERROR;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>
</span></span><span style=display:flex><span>     if( pNew-&gt;iFoldParam!=0 &amp;&amp; pNew-&gt;bFold==0 ){
</span></span><span style=display:flex><span>       rc = SQLITE_ERROR;
</span></span></code></pre></div></details><p>The patch changes the loop boundary and checks early exit to prevent
out-of-bounds access.
After the loop, there&rsquo;s an additional check:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span>( i<span style=color:#f92672>&lt;</span>nArg ) rc <span style=color:#f92672>=</span> SQLITE_ERROR; 
</span></span></code></pre></div><p>This check ensures that all arguments were processed. If <code>i</code> is less than
<code>nArg</code> after the loop, it means there was an odd numbers of arguments,
which is considered an error because the arguments should always come in pairs.</p><p>Interestingly, the maintainer patched <code>fts5UnicodeCreate()</code> and <code>fts5AsciiCreate()</code> as well
because similar code patterns existing there. It actually shows the
strength of human-write patches because developers remember potential
buggy paths in their code base. However, the additional checks are actually
unnecessary because the checks are already at the beginning of the functions.
It demonstrates human-write patches are not perfect as well.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>fts5AsciiCreate</span>(
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>pUnused, 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>azArg, <span style=color:#66d9ef>int</span> nArg,
</span></span><span style=display:flex><span>  Fts5Tokenizer <span style=color:#f92672>**</span>ppOut
</span></span><span style=display:flex><span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> SQLITE_OK;
</span></span><span style=display:flex><span>  AsciiTokenizer <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>UNUSED_PARAM</span>(pUnused);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>( nArg<span style=color:#f92672>%</span><span style=color:#ae81ff>2</span> ){   <span style=color:#f92672>&lt;----</span> already checks
</span></span><span style=display:flex><span>    rc <span style=color:#f92672>=</span> SQLITE_ERROR;
</span></span><span style=display:flex><span>  }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>--&gt;</span> unnecessary checks <span style=color:#f92672>&lt;---</span> 
</span></span></code></pre></div><p>I believe the maintainers notice the issues so that they changed their
patch in <a href=https://github.com/sqlite/sqlite/commit/b651084713e8bb9a6a7a0399a00677604d157b2f target=_blank>b651084</a>
by checking <code>if (nArgs % 2) == 0</code> at the beginning of <code>fts5TriCreate()</code>.
At the same time, they removed the unnecessary patches in <code>fts5AsciiCreate()</code>
and <code>fts5UnicodeCreate()</code>.</p><h2 id=the-authors-random-thoughts>The Author&rsquo;s Random Thoughts</h2><p>By leveraging generative AI models (GenAI) as &ldquo;high-level&rdquo; static analysis tools,
we can significantly enhance automated bug finding,
thanks to their proficiency in code explanation.
For example,
complex program analysis tasks such as points-to analysis and inter-procedural analysis,
which are challenging for traditional compilers,
can be approached differently using GenAI through retrieve-augmented generation (RAG).
Additionally,
GenAI opens new possibilities for automatic exploit generation and
vulnerability remediation due to its strong capabilities in code writing.</p><p>However, GenAI is not a cure-all and is far from perfect.
That&rsquo;s why our hybrid system is designed to improve GenAI&rsquo;s performance
in security research by addressing common issues such as LLM hallucinations,
scalability, and domain-specific challenges for particular software.</p><p>AIxCC has provided our team with a fantastic opportunity to put into practice
the insights gained from decades of security research in both academia and industry.
If you&rsquo;re interested in learning more about our team
and the work done by our <a href=/authors>team members</a>
, please feel free to
<a href=mailto:aixcc-atl@googlegroups.com>contact us</a>
!</p><p>Follow us on Twitter/X (<a href=https://x.com/TeamAtlanta24 target=_blank>@TeamAtlanta24</a>
)
if you&rsquo;re interested in AI or security.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Discovering previously unknown bugs does not count as a valid score in the competition.
Team Atlanta secured a finalist spot by submitting the intended bugs and patches for AIxCC.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The word &ldquo;perfect patch&rdquo; is a vague concept in my mind.
To clarify, a patch should comprehend the context and semantics of the program
and address the actual root causes rather than merely adding superficial checks to
bypass address sanitizers (<a href=https://clang.llvm.org/docs/AddressSanitizer.html target=_blank>ASAN</a>
).&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class="row items-start justify-between"><div class="lg:col-5 mb-10 flex items-center lg:mb-0"><h5 class=mr-3>Tags :</h5><ul><li class=inline-block><a class="bg-theme-light hover:bg-primary dark:bg-darkmode-theme-light dark:hover:bg-darkmode-primary dark:hover:text-dark m-1 block rounded px-3 py-1 hover:text-white" href=/tags/atlantis-crs/>Atlantis crs</a></li></ul></div><div class="lg:col-4 flex items-center"><div class=share-icons><h5 class=share-title>Share :</h5><a class="share-link share-facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fteam-atlanta.github.io%2fblog%2fpost-asc-sqlite%2f" target=_blank rel=noopener aria-label="share facebook"><span class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></span></a><a class="share-link share-twitter" href="https://twitter.com/intent/tweet/?text=Share&amp;url=https%3a%2f%2fteam-atlanta.github.io%2fblog%2fpost-asc-sqlite%2f" target=_blank rel=noopener aria-label="share twitter"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></span></a><a class="share-link share-email" href="mailto:?subject=Share&amp;body=https%3a%2f%2fteam-atlanta.github.io%2fblog%2fpost-asc-sqlite%2f" target=_self rel=noopener aria-label="share email"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></span></a><a class="share-link share-reddit" href="https://reddit.com/submit/?url=https%3a%2f%2fteam-atlanta.github.io%2fblog%2fpost-asc-sqlite%2f&amp;resubmit=true&amp;title=Share" target=_blank rel=noopener aria-label="share reddit"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></span></a></div></div></div></article></div><div class="section pb-0"><h2 class="h3 mb-12">Related Posts</h2><div class=row><div class=lg:col-4><div class="bg-body dark:bg-darkmode-body"><picture><source srcset=/images/blog/tkctf2024/ai-vs-human_huc3a6c22971e7c169e27cf9be07d57cad_1521184_545x0_resize_q90_h2_lanczos_3.webp media="(max-width: 575px)"><source srcset=/images/blog/tkctf2024/ai-vs-human_huc3a6c22971e7c169e27cf9be07d57cad_1521184_600x0_resize_q90_h2_lanczos_3.webp media="(max-width: 767px)"><source srcset=/images/blog/tkctf2024/ai-vs-human_huc3a6c22971e7c169e27cf9be07d57cad_1521184_700x0_resize_q90_h2_lanczos_3.webp media="(max-width: 991px)"><source srcset=/images/blog/tkctf2024/ai-vs-human_huc3a6c22971e7c169e27cf9be07d57cad_1521184_1110x0_resize_q90_h2_lanczos_3.webp><img loading=lazy decoding=async src=/images/blog/tkctf2024/ai-vs-human_huc3a6c22971e7c169e27cf9be07d57cad_1521184_1110x0_resize_lanczos_3.png class="mb-6 w-full rounded img" alt="Hacking Redefined: How LLM Agents Took on University Hacking Competition" width=1024 height=768></picture><h4 class=mb-3><a href=/blog/post-tkctf-2024/>Hacking Redefined: How LLM Agents Took on University Hacking Competition</a></h4><ul class=mb-4><li class="mr-4 inline-block"><a href=/authors/hanqing-zhao/><i class="fa-regular fa-circle-user mr-2"></i>Hanqing Zhao</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/milestone/ class=ms-1>Milestone</a></li></ul><p class=mb-6>For the first time, we deployed our hybrid system, powered by LLM agents—Atlantis —to compete in Georgia Tech’s flagship CTF event, TKCTF 2024 .</p><a class="btn btn-outline-primary btn-sm" href=/blog/post-tkctf-2024/>Read More</a></div></div><div class=lg:col-4><div class="bg-body dark:bg-darkmode-body"><picture><source srcset=/images/blog/atl/team_hua298431885ad4762626086ea59b71217_2822632_545x0_resize_q90_h2_lanczos_3.webp media="(max-width: 575px)"><source srcset=/images/blog/atl/team_hua298431885ad4762626086ea59b71217_2822632_600x0_resize_q90_h2_lanczos_3.webp media="(max-width: 767px)"><source srcset=/images/blog/atl/team_hua298431885ad4762626086ea59b71217_2822632_700x0_resize_q90_h2_lanczos_3.webp media="(max-width: 991px)"><source srcset=/images/blog/atl/team_hua298431885ad4762626086ea59b71217_2822632_1110x0_resize_q90_h2_lanczos_3.webp><img loading=lazy decoding=async src=/images/blog/atl/team_hua298431885ad4762626086ea59b71217_2822632_1110x0_resize_lanczos_3.png class="mb-6 w-full rounded img" alt="Announcing Team Atlanta!" width=1821 height=1366></picture><h4 class=mb-3><a href=/blog/post-atl/>Announcing Team Atlanta!</a></h4><ul class=mb-4><li class="mr-4 inline-block"><a href=/authors/taesoo-kim/><i class="fa-regular fa-circle-user mr-2"></i>Taesoo Kim</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/announcement/ class=ms-1>Announcement</a></li></ul><p class=mb-6>Hello, world! We are Team Atlanta, the minds behind Atlantis, our innovative AI-driven cybersecurity solution competing in the prestigious DARPA AIxCC .</p><a class="btn btn-outline-primary btn-sm" href=/blog/post-atl/>Read More</a></div></div></div></div></div></section></main><footer class="bg-theme-light dark:bg-darkmode-theme-light"><div class=container><div class="row items-center py-10"><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left"><a class="navbar-brand inline-block" href=/>Team Atlanta</a></div><div class="lg:col-6 mb-8 text-center lg:mb-0"><ul><li class="m-3 inline-block"><a href=/about/>About</a></li></ul></div><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right"><ul class=social-icons><li><a target=_blank aria-label=www rel="nofollow noopener" href=https://team-atlanta.github.io/><i class="fa-solid fa-house"></i></a></li><li><a target=_blank aria-label=twitter rel="nofollow noopener" href=https://x.com/TeamAtlanta24><i class="fab fa-twitter"></i></a></li><li><a target=_blank aria-label=github rel="nofollow noopener" href=https://github.com/Team-Atlanta/><i class="fab fa-github"></i></a></li></ul></div></div></div><div class="border-border dark:border-darkmode-border border-t py-7"><div class="text-light dark:text-darkmode-light container text-center"><p>Designed & Developed by <a href=https://zeon.studio target=_blank>Zeon Studio</a></p></div></div></footer><script crossorigin=anonymous integrity="sha256-JfCl05bpANVgFfythUbUTL7SszmLQ7wWqsqrkYSOBkU=" src=/js/script.min.25f0a5d396e900d56015fcad8546d44cbed2b3398b43bc16aacaab91848e0645.js></script><script defer async crossorigin=anonymous integrity="sha256-B6xkgfh/Kvqv5KhwfzCl2bDxX83d75UmDJHTJqlOs3M=" src=/js/script-lazy.min.07ac6481f87f2afaafe4a8707f30a5d9b0f15fcdddef95260c91d326a94eb373.js></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></body></html>